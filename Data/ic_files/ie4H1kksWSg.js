/*!CK:266467090!*//*1380813900,178134599*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ZbX6g"]); }

__d("ErrorDialog",["Dialog","emptyFunction"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('emptyFunction'),i={showAsyncError:function(j){try{return i.show(j.getErrorSummary(),j.getErrorDescription());}catch(k){alert(j);}},show:function(j,k,l,m){return (new g()).setTitle(j).setBody(k).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(l||h).setButtonsMessage(m||'').show();}};e.exports=i;});
__d("ImageUtils",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.webkit()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;});
__d("PhotoEverstoreLogger",["Event","AsyncRequest","copyProperties","ImageUtils"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('ImageUtils'),k={BATCH_WINDOW_MS:500,storedLog:[]};function l(){}i(l,{_log:function(n){k.storedLog.push(n);if(k.storedLog.length==1)setTimeout(m,k.BATCH_WINDOW_MS,false);},logImmediately:function(n){l._log(n);},registerForLogging:function(n){if(j.hasLoaded(n)){l._log(n.src);}else g.listen(n,'load',function(event){l._log(n.src);});}});function m(){var n=k.storedLog;k.storedLog=[];var o=JSON.stringify(n);new h().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:o}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}e.exports=l;});
__d("PhotoSessionLog",["AsyncRequest","Run","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Run'),i=b('Vector'),j=b('copyProperties');function k(){}j(k,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',faceTagImpressions:0,cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(l){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=l;this.buttonLikes=0;this.pagingAction='';this.faceTagImpressions=0;this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;if(l===k.SNOWLIFT){var m=i.getViewportDimensions();this.width=m.x;this.height=m.y;}},setLogFbids:function(l){this.logIds=l;},setPhotoSet:function(l){this.set=l;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(l){this.pagingAction=l;},addFaceTagImpression:function(){this.faceTagImpressions++;},setCycle:function(l){this.cycle=l;},setEndOfRelevant:function(l){this.endOfRelevant=l;},setRelevantCount:function(l){this.relevantCount=l;},setEndMetrics:function(l){this.endMetrics=l;},setSource:function(l){this.source=l;},addPhotoView:function(l,m,n){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(l)this.fbidList.push([l.fbid,l.owner,Date.now()]);if(m)this.hiResLoads++;if(n)this.fullScreenViews[l.fbid]=true;},logEnterFullScreen:function(l){this.fullScreenViews[l]=true;},addDetailData:function(l,m){if(!this.details[l])this.details[l]={t:m.num_tags,l:m.has_location,c:m.has_caption,cm:m.comment_count,lk:m.like_count,w:m.width,h:m.height,ad:'{}',p:this.pagingAction};},updateAdData:function(l,m){if(this.details[l])this.details[l].ad=JSON.stringify(m);},logPhotoViews:function(l){if(!this.views)return;if(l!=this.AGGREGATE)this.last=true;var m={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:l?l:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,face_imp:this.faceTagImpressions,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source};if(this.version===k.SNOWLIFT){var n=i.getViewportDimensions();m.width=n.x||this.width;m.height=n.y||this.height;if(this.hiResLoads>0)m.hires_loads=this.hiResLoads;if(this.last){var o=Object.keys(this.fullScreenViews).length;if(o>0)m.fullscreen=o;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(l!=k.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(m).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});h.onUnload(function(){k.logPhotoViews(k.UNLOAD);});h.onLeave(function(){k.logPhotoViews(k.LEAVE);});e.exports=k;});
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector"],function(a,b,c,d,e,f){var g=b('PhotoEverstoreLogger'),h=b('URI'),i=b('Vector');function j(k){this._hiResDimensions=k.hiResDimensions&&i.deserialize(k.hiResDimensions);this._normalDimensions=k.normalDimensions&&i.deserialize(k.normalDimensions);this._info=k.info;this._video=k.video;this._shouldLog=k.everstoreLogThis;this._hiResSrc=k.hiResSrc;this._normalSrc=k.normalSrc;this._thumbSrc=k.thumbSrc;this._isInverted=false;this._data=k;}j.prototype.getURIString=function(){return h(this._info.permalink).getUnqualifiedURI().toString();};j.prototype.hasHiResDimensions=function(){return !!this._hiResDimensions;};j.prototype.getHiResDimensions=function(){return this._hiResDimensions;};j.prototype.getNormalDimensions=function(){return this._normalDimensions;};j.prototype.getHiResSrc=function(){return this._hiResSrc;};j.prototype.getNormalSrc=function(){return this._normalSrc;};j.prototype.getThumbSrc=function(){return this._thumbSrc;};j.prototype.getInfo=function(){return this._info;};j.prototype.getPermalink=function(){return this._info.permalink;};j.prototype.getHighestResSrc=function(){return this._hiResSrc||this._normalSrc;};j.prototype.preload=function(k){var l;if(this.getHighestResSrc())if(k&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();l=this._resource.src;if(this._shouldLog)g.logImmediately(this._resource.src);}else if(!k&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;l=this._small.src;if(this._shouldLog)g.logImmediately(this._small.src);}return l;};j.prototype.setNormalDimensions=function(k,l){this._normalDimensions=new i(k,l);};j.prototype.setHiResDimensions=function(k,l){this._hiResDimensions=new i(k,l);};j.prototype.invertDimensions=function(){if(this.hasHiResDimensions())this._hiResDimensions=new i(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new i(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;};j.prototype.copy=function(){return new j(this._data);};e.exports=j;});
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_PERMALINK_STRING:'permalink',VIEWER_SNOWLIFT_STRING:'snowlift',VIEWER_VAULTBOX_STRING:'vaultbox',BULK_EDITOR:3,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180};e.exports=g;});
__d("PhotosUtils",["copyProperties","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Vector');function i(){}g(i,{getNearestBox:function(j,k){var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n;}}}return m;},absoluteToNormalizedPosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain='pure';return n;},normalizedToAbsolutePosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain='document';return n;},isFacebox:function(j){return j.match(/^face:/);},isTag:function(j){return j.match(/^tag:/);}});e.exports=i;});
__d("PhotoPermalinkURI",[],function(a,b,c,d,e,f){var g={isValid:function(h){return g.parse(h)!==null;},parse:function(h){var i=h.getPath();if(i==='/photo.php'){var j=h.getQueryData();return {photo_id:j.fbid,set_token:j.set};}if(i[i.length-1]==='/')i=i.substring(0,i.length-1);var k=i.split('/');if(k.length>=3&&k[2]==='photos')if(k.length===4&&/^\d+$/.exec(k[3])!==null){return {photo_id:k[3],set_token:null};}else if(k.length===5&&/^\d+$/.exec(k[4])!==null)return {photo_id:k[4],set_token:k[3]};return null;}};e.exports=g;});
__d("PhotoStreamCache",["DOM","HTML","PhotoEverstoreLogger","PhotosConst","PhotoViewerImage","Rect","UIPagelet","URI","Vector","copyProperties","createArrayFrom","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('HTML'),i=b('PhotoEverstoreLogger'),j=b('PhotosConst'),k=b('PhotoViewerImage'),l=b('Rect'),m=b('UIPagelet'),n=b('URI'),o=b('Vector'),p=b('copyProperties'),q=b('createArrayFrom'),r=b('ge');function s(){}s.prototype.init=function(t,u,v,w){this.version=t;this.pageletName=u;this.pageletRootID=v;this.bufferSize=s.BUFFER_SIZE;this.fullBucketSize=s.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=w;this.reset();};s.prototype.getUsesOpaqueCursor=function(){return this.usesOpaqueCursor;};s.prototype.isNonCircularPhotoSet=function(){return this.usesNonCircularPhotoSet;};s.prototype.setReachedLeftEnd=function(){this.reachedLeftEnd=true;};s.prototype.setReachedRightEnd=function(){this.reachedRightEnd=true;};s.prototype.hasReachedLeftEnd=function(){return this.reachedLeftEnd;};s.prototype.hasReachedRightEnd=function(){return this.reachedRightEnd;};s.prototype.nonCircularPhotoSetCanPage=function(t){if(!this.isNonCircularPhotoSet())return true;if(t<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(t>0)return (this.getLength()-1!=this.getCursorPos())||!this.hasReachedRightEnd();return true;};s.prototype.setUseAjaxPipe=function(t){this.useAjaxPipe=t;};s.prototype.reset=function(){this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;};s.prototype.waitForInitData=function(){this.fbidList.push(s.INIT_PLACEHOLDER);};s.prototype.destroy=function(){this.reset();this.isActive=false;};s.prototype.isLoaded=function(){return this.loaded;};s.prototype.canPage=function(){if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;};s.prototype.errorInCurrent=function(){if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());};s.prototype.getLength=function(){return this.fbidList.length;};s.prototype.getPhotoSet=function(){return this.photoSetQuery.set;};s.prototype.getPhotoSetQuery=function(){return this.photoSetQuery;};s.prototype.getCurrentImageData=function(){return this.getImageData(this.getCursor());};s.prototype.getOpaqueCursor=function(t){if(this.getImageData(t)){if(this.version===j.VIEWER_VAULTBOX)return this.getImageData(t).getInfo().opaquecursor;return this.getImageData(t).info.opaquecursor;}if(t==this.firstCursor)return this.firstOpaqueCursor;return null;};s.prototype.getImageData=function(t){return this.getCacheContent(t,s.IMAGE_DATA);};s.prototype.getCurrentHtml=function(){return this.getCacheContent(this.getCursor(),s.HTML);};s.prototype.getCurrentExtraData=function(){return this.getCacheContent(this.getCursor(),s.EXTRA);};s.prototype.getCacheContent=function(t,u){if(!t||t===s.ERROR_ID||t===s.INIT_PLACEHOLDER)return null;return this.cache[u][t];};s.prototype.getCursorPos=function(){return this.position;};s.prototype.getCursor=function(){if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;};s.prototype.getCursorForURI=function(t){return this.permalinkMap[t];};s.prototype.calculatePositionForMovement=function(t){var u=this.position+t;if(this.allLoaded){var v=this.getLength();u=(v+u%v)%v;}return u;};s.prototype.isValidMovement=function(t){if(!this.isLoaded()||!this.canPage())return false;var u=this.calculatePositionForMovement(t);return this.getCursor()>0||(u>=0&&u<this.getLength());};s.prototype.moveCursor=function(t){if(!this.isValidMovement(t))return;this.position=this.calculatePositionForMovement(t);if(t!==0)this.loadMoreIfNeccessary(t>0);};s.prototype.checkErrorAt=function(t){if(!this.isLoaded())return false;if(t===s.ERROR_ID)return true;return false;};s.prototype.getRelativeMovement=function(t){for(var u=0;u<this.getLength();u++)if(this.fbidList[u]==t)return u-this.position;return null;};s.prototype.preloadImages=function(t){var u,v,w=this.getLength(),x=this.cache.image,y=s.BUFFER_SIZE;if(w>y*2){u=(this.position+w-y%w)%w;v=(this.position+y)%w;}else{u=0;v=w-1;}while(u!=v){var z,aa=this.fbidList[u],ba=t&&t(x[aa]);if(this.version===j.VIEWER_VAULTBOX){z=x[aa]&&x[aa].preload(ba);}else if(x[aa]&&x[aa].url)if(ba&&!x[aa].resource){x[aa].resource=new Image();x[aa].resource.src=x[aa].url;z=x[aa].url;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].resource.src);}else if(!ba&&!x[aa].small){x[aa].small=new Image();x[aa].small.src=x[aa].smallurl||x[aa].url;z=x[aa].small.src;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].small.src);}if(this.logger&&z)this.logger.log(z);u=(u+1)%w;}};s.prototype.loadMoreIfNeccessary=function(t){if(this.allLoaded||(t&&this.rightLock)||(!t&&this.leftLock))return;var u=t?1:-1,v=this.position+this.bufferSize*u;if(v<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(v>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}};s.prototype.getEndCursor=function(t){return t?this.fbidList[this.getLength()-1]:this.fbidList[0];};s.prototype.calculateRelativeIndex=function(t,u,v){if(!this.totalCount)return null;var w=this.fbidList.indexOf(u),x=this.fbidList.indexOf(v);if(w===-1||x===-1)return null;var y=x-w;return (t+y+this.totalCount)%this.totalCount;};s.prototype.calculateDistance=function(t,u){var v=this.fbidList.indexOf(t),w=this.fbidList.indexOf(u);if(v===-1||w===-1)return null;return (w-v+this.getLength())%this.getLength();};s.prototype.fetch=function(t,u){var v=this.getEndCursor(u),w=p({cursor:v,version:this.version,end:this.getEndCursor(!u),fetchSize:u?t:-1*t,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(v)},this.photoSetQuery);if(this.totalCount&&this.firstCursorIndex!==null){w.total=this.totalCount;w.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,v);}var x=r(this.pageletRootID);if(!x){x=g.create('div',{id:this.pageletRootID});g.appendContent(document.body,x);}m.loadFromEndpoint(this.pageletName,x,w,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);};s.prototype.storeToCache=function(t){var u={};if(!this.isActive)return u;if('error' in t){this.processErrorResult(t.error);u.error=true;return u;}if('init' in t){this.processInitResult(t.init);u.init={logids:t.init.logids,fbid:t.init.fbid,loggedin:t.init.loggedin,fromad:t.init.fromad,disablesessionads:t.init.disablesessionads,flashtags:t.init.flashtags};}if('image' in t){this.processImageResult(t.image);u.image=true;}if('data' in t){this.processDataResult(t.data);u.data=true;}return u;};s.prototype.processInitResult=function(t){if(this.loaded)return;this.usesOpaqueCursor=t.usesopaquecursor;this.usesNonCircularPhotoSet=t.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=t.query;if(t.bufferSize)this.bufferSize=t.bufferSize;if(t.fullBucketSize)this.fullBucketSize=t.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(t.fbid);this.rightLock=true;}else{var u=this.fbidList.indexOf(s.INIT_PLACEHOLDER);if(u!=-1)this.fbidList[u]=t.fbid;}this.firstCursor=t.fbid;this.firstOpaqueCursor=t.opaquecursor;if('initIndex' in t&&'totalCount' in t){this.firstCursorIndex=t.initIndex;this.totalCount=t.totalCount;}if(this.version==j.VIEWER_PERMALINK)this.fetch(s.INIT_BUCKET_SIZE,true);};s.prototype.processImageResult=function(t){for(var u in t){if(u===this.firstCursor&&t[u].everstoreLogThis)i.logImmediately(t[u].url);if(this.version===j.VIEWER_VAULTBOX){var v=t[u];this.cache.image[u]=new k(v);this.permalinkMap[this.cache.image[u].getURIString()]=u;}else{this.cache.image[u]=t[u];if(t[u].dimensions)this.cache.image[u].dimensions=o.deserialize(t[u].dimensions);if(t[u].smalldims)this.cache.image[u].smalldims=o.deserialize(t[u].smalldims);this.permalinkMap[n(t[u].info.permalink).getUnqualifiedURI().toString()]=u;}}};s.prototype.attachToFbidsList=function(t,u,v){if(this.allLoaded)return;if(u===-1){for(var w=t.length-1;w>=0;w--){this.fbidList.unshift(t[w]);this.position++;}this.leftLock=false;}else{for(var x=0;x<t.length;x++)this.fbidList.push(t[x]);this.rightLock=false;}if(v)this.setAllLoaded();};s.prototype.setAllLoaded=function(){this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);};s.prototype.processDataResult=function(t){for(var u in t){if(!this.cache.html[u])this.cache.html[u]={};for(var v in t[u].html){var w=t[u].html[v];if(typeof w==='string')w=h(w).getRootNode();this.cache.html[u][v]=q(w.childNodes);}if(!('extra' in t[u])){this.cache.extra[u]=null;continue;}this.cache.extra[u]={tagRects:{}};if(!Array.isArray(t[u].extra.tagRects))for(var x in t[u].extra.tagRects)if(t[u].extra.tagRects[x])this.cache.extra[u].tagRects[x]=l.deserialize(t[u].extra.tagRects[x]);Object.keys(t[u].extra).forEach(function(y){if(y=='tagRects')return;this.cache.extra[u][y]=t[u].extra[y];}.bind(this));}};s.prototype.processErrorResult=function(t){if(!this.isLoaded()){this.initError=true;return;}var u=t.side,v=[s.ERROR_ID];this.attachToFbidsList(v,u);};s.prototype.setTotalCount=function(t){this.totalCount=t;};s.prototype.setFirstCursorIndex=function(t){this.firstCursorIndex=t;};p(s,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});e.exports=s;});
__d("PhotoSnowliftAds",["Event","copyProperties","CSS","csx","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector","extendArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('copyProperties'),i=b('CSS'),j=b('csx'),k=b('DataStore'),l=b('DOM'),m=b('PhotoSessionLog'),n=b('UIPagelet'),o=b('URI'),p=b('Vector'),q=b('extendArray'),r={DEFAULT_UNITS_REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,refreshUnitsRate:null,position:null,adsStatus:'null',adsEvents:{},snowliftRedesign:false,resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(s,t){if(t)this.adsStatus=s;var u=Date.now();this.adsEvents[s+'_'+u]=u;},init:function(s,t,u,v){this.reset();this.root=s;this.snowlift=t;this.minAds=u.min_ads;this.displayedCallback=v;this.addEvent('init',true);this.snowliftRedesign=u.snowlift_redesign;this.refreshUnitsRate=r.DEFAULT_UNITS_REFRESH_RATE;if(u.refresh_fast)this.refreshUnitsRate=u.refresh_rate;},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(s){this.availableDimensions=s;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(s,t,u){var v={};s.forEach(function(w){var x=w.root.firstChild.offsetHeight;w.units.forEach(function(z){if(!i.hasClass(z,'hidden')&&!this.getIsHoldout(z)){var aa=this.getHeight(z.firstChild,t);x-=aa;}}.bind(this));var y={height:x,visible:false};w.units.forEach(function(z){var aa=this.getIsAds(z),ba=this.getHeight(z.firstChild,t),ca=this.getUnitId(z),da=this.getIsHoldout(z);if(da&&u)return;v[ca]={height:ba,visible:false,priority:0,is_ads:aa,is_holdout:da,section_ref:y};}.bind(this));}.bind(this));return v;},calculateVisibleUnits:function(s,t,u){var v=0,w=this.getUnitPriority(t);w.forEach(function(x){if(t.hasOwnProperty(x)){var y=t[x],z=y.height;if(!y.section_ref.visible)z+=y.section_ref.height;y.height_below=u-z;y.visible=y.height_below>=0&&z>0;if(y.visible){y.section_ref.visible=true;u-=z;v++;}}}.bind(this));return t;},displayUnits:function(s,t){s.forEach(function(u){var v=false,w=true;u.units.forEach(function(x){var y=this.getUnitId(x),z=t[y];if(!z)return;var aa=z.visible,ba=z.height_below,ca=z.is_ads;i.conditionClass(x,'hidden',!aa);if(ca&&aa&&w){var da=l.find(x,'div.ego_unit');i.addClass(da,'ego_unit_no_top_border');w=false;}v=v||aa;this.calcUnitStats(this.units[ca][y],aa,ba);}.bind(this));i.conditionClass(u.root,'hidden',!v);}.bind(this));},getUnitsDisplayed:function(s,t){var u=0;s.forEach(function(v){v.units.forEach(function(w){var x=this.getUnitId(w),y=t[x];if(!y||!y.visible)return;u++;}.bind(this));}.bind(this));return u;},getHeightsRequired:function(s,t){var u=0,v=[];s.forEach(function(w){var x=false;w.units.forEach(function(y){var z=this.getUnitId(y),aa=t[z];if(!aa)return;u+=aa.height;if(!x){u+=aa.section_ref.height;x=true;}v.push(u);}.bind(this));}.bind(this));return v;},getUnitPriority:function(s){var t=[],u=0,v=0;for(var w in s){var x=s[w];t.push(w);var y=this.minAds+u+v;if(x.is_ads){if(v<this.minAds)y=v;v++;}else u++;x.priority=y;}t=t.sort(function(z,aa){var ba=s[z],ca=s[aa];return ba.priority-ca.priority;}.bind(this));return t;},updateUnitsStatus:function(){var s=this.availableDimensions.x,t=this.availableDimensions.y,u=this.calculateUnitSizes(this.sections,s);u=this.calculateVisibleUnits(this.sections,u,t);for(var v in u){if(!u.hasOwnProperty(v))continue;var w=u[v];if(!w.is_holdout||!w.visible)continue;var x=this.units[1][v];this.calcUnitStats(x,w.visible,w.height_below);}u=this.calculateUnitSizes(this.sections,s,true);u=this.calculateVisibleUnits(this.sections,u,t);this.displayUnits(this.sections,u);if(this.displayedCallback){var y=this.getUnitsDisplayed(this.sections,u),z=this.getHeightsRequired(this.sections,u);this.displayedCallback(y,z);}},calcUnitStats:function(s,t,u){var v=Date.now();if(s.visible)s.totalTime+=v-s.lastShowTime;if(s.trackingCode!==null&&s.totalTime>=this.UNITS_REGISTER_DELAY){var w=s.trackingCode;s.trackingCode=null;this.registerImpression(w,s.registerUrl);}s.visible=t;s.heightBelow=u;s.lastShowTime=v;},prepareResize:function(){var s=function(t){var u=l.create('div',{className:'inner'}),v=l.create('div',{className:'wrapper'},u);l.replace(t,v);l.setContent(u,t);return v;};this.sections=l.scry(this.root,'div.ego_section').map(function(t){return {root:s(t),units:l.scry(t,'div.ego_unit').map(s)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var s=this.nextRegisterTime();if(s!==Infinity)this.processResize.bind(this).defer(s,true);},setIsLogAdData:function(s){this.isLogAdData=s;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var s=this.snowlift.getImageId();if(this.isLogAdData&&s){var t=p.getElementDimensions(this.snowlift.getImage()),u=p.getElementDimensions(this.snowlift.getRHCHeader()),v=p.getElementDimensions(this.snowlift.getRHCBody()),w=p.getElementDimensions(this.snowlift.getRHCFooter()),x={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:t.x,image_y:t.y,header_x:u.x,header_y:u.y,body_x:v.x,body_y:v.y,footer_x:w.x,footer_y:w.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};m.updateAdData(s,x);}},getAdsBelowSpace:function(){var s=[],t=this.units[1];for(var u in t)if(t.hasOwnProperty(u)&&!this.getIsHoldout(this.getAdUnit(u)))s.push(t[u].heightBelow);return s;},getIsAds:function(s){var t=l.scry(s,"div._4u8");return t.length;},getUnitId:function(s){if(this.getIsAds(s)){return this.getAdId(s);}else return this.getEgoId(s);},getEgoId:function(s){var t=l.find(s,'div.ego_unit');return t.getAttribute('data-ego-fbid');},getAdData:function(s){var t=l.find(s,"div._4u8"),u=t.getAttribute('data-ad');return u&&JSON.parse(u)||{};},getAdId:function(s){return this.getAdData(s).adid;},getIsHoldout:function(s){return s&&this.getIsAds(s)&&this.getAdData(s).holdout;},getAdUnit:function(s){if(!this.sections)return null;var t=[];this.sections.forEach(function(v){q(t,v.units);});for(var u=0;u<t.length;u++)if(this.getIsAds(t[u])&&this.getAdId(t[u])==s)return t[u];return null;},nextRegisterTime:function(){var s=Infinity,t=h(h({},this.units[0]),this.units[1]);for(var u in t)if(t.hasOwnProperty(u)){var v=t[u];if(v.trackingCode!==null&&v.visible)s=Math.min(s,this.UNITS_REGISTER_DELAY-v.totalTime);}return s;},getHeight:function(s,t){var u=k.get(s,'height');if(u&&u.x===t)return u.y;return this.cacheHeight(s,t);},cacheHeight:function(s,t){var u={x:t,y:s.offsetHeight};k.set(s,'height',u);return u.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var s=this.getCursorFBID(this.loadQuery);n.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,s,this.snowliftRedesign,this.snowlift.getOpaqueCursor(s)]},{crossPage:true,bundle:false});},getCursorFBID:function(s){if(s.v!==undefined)return s.v;if(s.fbid!==undefined)return s.fbid;return '0';},unitsLoaded:function(s,t){var u;if(t){u='/ai.php';this.addEvent('adsLoaded',true);}else{u='/ajax/ei.php';this.addEvent('egoLoaded',true);}var v={};for(var w in s)if(s.hasOwnProperty(w))v[w]={trackingCode:s[w],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:u};this.units[t]=v;if(t)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();i.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var s=Date.now(),t=this.refreshUnitsRate;if(!this.isLoading&&s-this.lastLoadTime>t){i.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(s,t){var u=l.create('iframe',{src:o(t).addQueryData({aed:s}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});u.setAttribute('aria-hidden','true');l.appendContent(this.root,u);},waitForImages:function(s){var t=l.scry(this.root,'img.img'),u=t.length,v=u;if(v===0)s();var w=function(){v--;if(v===0)s.defer();};for(var x=0;x<u;x++){var y=t[x];if(y.complete){w();}else g.listen(y,{load:w,error:w,abort:w});}}};e.exports=r;});
__d("PhotoViewer",["Bootloader","CSS","DOM","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('CSS'),i=b('DOM'),j=b('copyProperties'),k=b('emptyFunction');function l(){this.image=null;this.root=null;this.stream=null;}l.prototype.getEventString=function(m){var n=this.getEventPrefix();if(n)return n+'.'+m;return null;};l.prototype.getImage=function(){return this.image;};l.prototype.getPosition=function(){return this.stream?this.stream.getCursor():null;};l.prototype.getRoot=function(){return this.root;};l.prototype.hiliteAllBoxes=function(){i.scry(this.stageWrapper,'div.tagsWrapper div.faceBox').forEach(function(m){h.addClass(m,'otherActive');});};l.bootstrap=function(m,n){g.loadModules(['PhotoSnowlift'],function(o){o.bootstrap(m,n);});};j(l.prototype,{getEventPrefix:k.thatReturnsNull,getSourceString:k.thatReturnsNull,getVersionConst:k.thatReturnsNull,getViewerSource:k.thatReturnsNull,getViewerSet:k.thatReturnsNull});e.exports=l;});
__d("PhotoSnowlift",["function-extensions","Arbiter","Assert","AsyncDialog","AsyncRequest","Bootloader","CSS","Dialog","DOM","DOMControl","Event","FullScreen","ImageUtils","Input","Keys","Layer","LinkController","Locale","PageTransitions","Parent","PhotosConst","PhotoLogger","PhotoPermalinkURI","PhotoSessionLog","PhotoSnowliftAds","PhotoStreamCache","PhotosUtils","PhotoViewer","Rect","ScrollableArea","Style","Toggler","UIPagelet","URI","UserAgent","Vector","$","asyncCallback","computeRelativeURI","copyProperties","createArrayFrom","csx","cx","emptyFunction","ge","goURI","shield","startsWith","tx","userAction"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('Assert'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('Bootloader'),l=b('CSS'),m=b('Dialog'),n=b('DOM'),o=b('DOMControl'),p=b('Event'),q=b('FullScreen'),r=b('ImageUtils'),s=b('Input'),t=b('Keys'),u=b('Layer'),v=b('LinkController'),w=b('Locale'),x=b('PageTransitions'),y=b('Parent'),z=b('PhotosConst'),aa=b('PhotoLogger'),ba=b('PhotoPermalinkURI'),ca=b('PhotoSessionLog'),da=b('PhotoSnowliftAds'),ea=b('PhotoStreamCache'),fa=b('PhotosUtils'),ga=b('PhotoViewer'),ha=b('Rect'),ia=b('ScrollableArea'),ja=b('Style'),ka=b('Toggler'),la=b('UIPagelet'),ma=b('URI'),na=b('UserAgent'),oa=b('Vector'),pa=b('$'),qa=b('asyncCallback'),ra=b('computeRelativeURI'),sa=b('copyProperties'),ta=b('createArrayFrom'),ua=b('csx'),va=b('cx'),wa=b('emptyFunction'),xa=b('ge'),ya=b('goURI'),za=b('shield'),ab=b('startsWith'),bb=b('tx'),cb=b('userAction'),db=74,eb=75,fb=70,gb=76;for(var hb in ga)if(ga.hasOwnProperty(hb))jb[hb]=ga[hb];var ib=ga===null?null:ga.prototype;jb.prototype=Object.create(ib);jb.prototype.constructor=jb;jb.__superConstructor__=ga;function jb(){if(ga!==null)ga.apply(this,arguments);}jb.prototype.preload=function(kb,lb){k.loadModules(['PhotoTagger','Live','PhotoTagApproval','PhotoTags','TagTokenizer','fb-photos-snowlift-fullscreen-css'],function(nb){this.PhotoTagger=nb;}.bind(this));var mb=this.getImageSrc(ma(kb).getQueryData());if(mb)if(!this._log(mb))(new Image()).src=mb;};jb.prototype.bootstrap=function(kb,lb){if(kb&&ma(kb).getQueryData().makeprofile){this.enableCropperOnInit=true;this.isUserProfilePic=ma(kb).getQueryData().makeuserprofile;this.isInProfilePicAlbum=ma(kb).getQueryData().inprofilepicalbum;}this.preload(kb,lb);if(this.closeDirty){this.bootstrap.bind(this,kb,lb).defer();return;}da.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=cb('snowlift',lb).uai('open');this.returningToStart=false;this.loading&&l.removeClass(this.loading,'loading');if(lb){l.addClass((this.loading=lb),'loading');if(this.container){var mb=y.byClass(lb,'uiStreamStory')||y.byClass(lb,"_5jmm");if(mb){this.container.setAttribute('data-ownerid',mb.id);}else this.container.removeAttribute('data-ownerid');}this.getThumbAndSize(lb);}else this.loading=null;g.inform('PhotoSnowlift.GO',kb,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};jb.prototype.getCurrentImageServerSizeDimensions=function(){return this.stream.getCurrentImageData().dimensions;};jb.prototype.getEventPrefix=function(){return 'PhotoSnowlift';};jb.prototype.getRoot=function(){return this.root;};jb.prototype.getSourceString=function(){return 'snowlift';};jb.prototype.getViewerSource=function(){return this.source;};jb.prototype.getViewerSet=function(){return this.stream.getPhotoSet();};jb.prototype.getVersionConst=function(){return z.VIEWER_SNOWLIFT;};jb.prototype.getImage=function(){return this.image;};jb.prototype.getImageId=function(){return this.stream.getCursor();};jb.prototype.getRHCHeader=function(){return this.rhcHeader;};jb.prototype.getRHCBody=function(){return this.ufiForm;};jb.prototype.getRHCFooter=function(){return this.rhcFooter;};jb.prototype.getLoadQuery=function(){return this.loadQuery;};jb.prototype.getCurrentPhotoInfo=function(){var kb=this.stream.getCurrentImageData();if(kb)return kb.info;return null;};jb.prototype.getOwnerId=function(){var kb=this.stream.getCurrentImageData();if(kb)return kb.info.owner;return null;};jb.prototype.getThumbAndSize=function(kb){this.currentImageSize=null;this.thumbSrc=null;var lb=ma(kb.getAttribute('ajaxify')).getQueryData();if(!lb.size)return;var mb=oa.deserialize(lb.size);if(!mb.x||!mb.y)return;this.currentImageSize=mb;if(!l.hasClass(kb,'uiMediaThumb')&&!l.hasClass(kb,'uiPhotoThumb')&&!l.hasClass(kb,'uiScaledThumb'))return;if(kb.getAttribute('data-cropped'))return;var nb=n.scry(kb,'img')[0],ob=n.scry(kb,'i')[0],pb=y.byAttribute(kb,'data-size');this.shouldStretch=pb&&this.currentImageSize&&nb&&pb.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=jb.TIMELINE_STRETCH_WIDTH&&nb.offsetWidth===jb.TIMELINE_STRETCH_WIDTH;var qb;if(nb){qb=nb.src;}else if(ob){qb=ja.get(ob,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=qb;};jb.prototype.loadFrameIfUninitialized=function(){if(this.root)return;new j('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};jb.prototype.init=function(kb,lb){this.init=wa;this._shouldLog=lb.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new aa(z.VIEWER_SNOWLIFT_STRING);this.showHover=lb.pivot_hover;ca.setEndMetrics(lb.pivot_end_metric);this.enableSnowliftProfilePicCropper=lb.snowlift_profile_pic_cropper;this.pagersOnKeyboardNav=lb.pagers_on_keyboard_nav;this.shouldKeepFacebox=lb.keep_facebox_on_click;this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=q.isSupported();this.showOGVideos=lb.og_videos;this.resizeCommentsForAds=lb.resize_comments_for_ads;this.stageMax=jb.STAGE_HIRES_MAX;this.spotlight=kb;this.spotlight.subscribe('blur',function(){this.closingAction=ca.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',za(this.closeHandler,this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());da.init(this.sideAdUnit,this,lb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){v.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(mb,nb){this.openExplicitly=true;this.loading&&l.removeClass(this.loading,'loading');this.open(nb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;x.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)q.subscribe('changed',this.onFullScreenChange.bind(this));this.redesign=lb.snowlift_redesign;this.slideshowGk=lb.snowlift_slideshow;};jb.prototype.onFullScreenChange=function(){var kb=q.isFullScreen();l.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',kb);if(kb){if(!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var lb=this.stream.getCurrentImageData();if(lb&&lb.url&&this.image.src!==lb.url&&this.shouldShowHiRes(lb))this.switchImage(lb.url);this.adjustForResize();}else{this.uncollapseRHC();if(na.chrome()&&!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);g.inform('reflow');}ka.hide();if(this.cropper)this.cropper.resetPhoto();};jb.prototype.initializeNodes=function(kb){this.root=kb;this.container=n.find(kb,'div.fbPhotoSnowliftContainer');this.snowliftPopup=n.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=n.find(this.snowliftPopup,'div.rhc');this.rhcHeader=n.find(this.rhc,'div.rhcHeader');this.rhcFooter=n.find(this.rhc,'div.rhcFooter');this.ufiForm=n.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=n.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=n.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=n.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=n.find(this.snowliftPopup,'div.stageWrapper');this.overlay=n.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=n.find(this.stageWrapper,'div.stageError');this.image=n.find(this.stageWrapper,'img.spotlight');this.stage=n.find(this.stageWrapper,'div.stage');this.videoStage=n.find(this.stageWrapper,'div.videoStage');this.prevPager=n.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=n.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=n.find(kb,'div.stageActions');this.buttonActions=n.find(this.stageActions,'div.fbPhotosPhotoButtons');this.productMetadata=n.scry(this.rhc,'div.fbPhotosSnowliftProductMetadata').pop();this.sideAdUnit=n.find(kb,"._5ciw");g.inform('Amoeba/instrumentMulti',[[this.container,'snowlift'],[this.rhc,'rhc'],[this.rhcHeader,'rhc_header'],[this.ufiForm,'ufi_form'],[this.ufiInputContainer,'ufi_input'],[this.prevPager,'prev_pager'],[this.nextPager,'next_pager'],[this.stageActions,'stage_actions'],[this.sideAdUnit,'side_ads']],g.BEHAVIOR_PERSISTENT);l.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};jb.prototype.initializeScroller=function(){this.initializeScroller=wa;this.scrollableArea=ia.fromNative(this.scroller,{fade:true,persistent:true});var kb=function(event){var lb=p.$E(event).getTarget();if(n.contains(this.ufiInputContainer,lb)){var mb=o.getInstance(lb);if(mb){this.scrollableArea.scrollToBottom();var nb=mb.subscribe('resize',function(){var pb=this.scrollableArea.isScrolledToBottom();this.adjustScroller();pb&&this.scrollableArea.scrollToBottom();}.bind(this)),ob=p.listen(lb,'blur',function(){mb.unsubscribe(nb);ob.remove();});}}}.bind(this);g.subscribe('ufi/changed',function(lb,mb){if(this.ufiForm===mb.form)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/comment',function(lb,mb){if(this.ufiForm===mb.form){this.adjustScrollerIfNecessary();if(mb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));p.listen(this.rhc,'click',function(event){var lb=event.getTarget();if(y.byTag(lb,'a')||y.byTag(lb,'button')||n.isNodeOfType(lb,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));p.listen(this.ufiForm,'focusin',kb);};jb.prototype.openHandler=function(kb){if(this.isOpen||!ba.isValid(kb)||this.returningToStart||kb.getQueryData().closeTheater||kb.getQueryData().permPage||kb.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(kb);this._uriStack.push(ma(kb).getQualifiedURI().toString());x.transitionComplete(true);return true;};jb.prototype.getImageSrc=function(kb){if(kb.smallsrc){if(!kb.size)return kb.smallsrc;var lb=oa.deserialize(kb.size),mb=this.getStageSize(lb);mb=this._adjustStageSizeForPixelRatio(mb);if(mb.x<=jb.STAGE_NORMAL_MAX.x&&mb.y<=jb.STAGE_NORMAL_MAX.y)return kb.smallsrc;}return kb.src;};jb.prototype.open=function(kb){var lb=ma(kb),mb=lb.getQueryData(),nb=ba.parse(lb);if(nb!==null){mb.fbid=nb.photo_id;mb.set=nb.set_token;}var ob=this.getImageSrc(mb);if(ob){delete mb.src;delete mb.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){mb.firstLoad=true;this.initialLoad=true;}this.sessionID=Date.now();this.sessionPhotosHilited={};this.loadQuery=sa(mb,{ssid:this.sessionID});this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.source=null;this.saveTagSubscription=g.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new ea();this.stream.init(z.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null);this.fetchInitialData();this.setLoadingState(jb.STATE_HTML,true);this.rhcCollapsed=false;this._open(kb,ob);if(this.enableSnowliftProfilePicCropper)k.loadModules(['SnowliftPicCropper'],function(pb){this.cropper=pb.getInstance(this);this.cropper.init();if(this.enableCropperOnInit){var qb=g.subscribe('PhotoSnowlift.SWITCH_IMAGE',function(){if(this.isInProfilePicAlbum){this.cropper.showPicInProfileAlbumDialog();}else this.cropper.enableCropping(this.isUserProfilePic);g.unsubscribe(qb);}.bind(this));this.enableCropperOnInit=false;}}.bind(this));k.loadModules(['PhotosButtonTooltips'],function(pb){pb.init();});};jb.prototype._open=function(kb,lb){this.createLoader(lb);this.spotlight.show();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[p.listen(window,'resize',this.adjustForResize.bind(this)),p.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),p.listen(this.stageWrapper,'mouseleave',function(event){var ob=event.getTarget();if(!(y.byClass(ob,'snowliftOverlay')||y.byClass(ob,'fbPhotoSnowliftTagApproval')||y.byClass(ob,'tagPointer')||y.byClass(ob,'arrow')||y.byClass(ob,'faceboxSuggestion')||y.byClass(ob,'typeaheadWrapper')||y.byClass(ob,'photoTagTypeahead')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),p.listen(this.stageWrapper,'mousemove',this.hilitePagerOnMouseMove.bind(this)),p.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),p.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this))];this.stageHandlers.push(p.listen(this.container,'click',function(event){var ob=event.getTarget();if(y.byClass(ob,'rotateRight')){this.rotate('right');}else if(y.byClass(ob,'rotateLeft')){this.rotate('left');}else if(y.byClass(ob,'closeTheater')){if(q.isFullScreen()){q.toggleFullScreen();return;}this.closingAction=ca.X;this.closeHandler();return false;}else if(this.fullscreen)if(y.byClass(ob,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(y.byClass(ob,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var mb=xa('fbPhotoSnowliftFeedback');if(mb)this.stageHandlers.push(p.listen(mb,'click',function(event){var ob=event.getTarget();if(y.byClass(ob,'like_link')||(y.byClass(ob,'UFILikeLink')&&y.byClass(ob,'UIActionLinks'))||(this.redesign&&y.byClass(ob,"_6k6")))this.toggleLikeButton();var pb=y.byClass(event.getTarget(),'uiUfiCollapsedComment');if(pb)l.addClass(pb,'uiUfiCollapsedCommentToggle');}.bind(this)));var nb=xa('fbPhotoSnowliftOnProfile');if(nb)this.stageHandlers.push(p.listen(nb,'click',function(event){if(y.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=ma.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!lb)this.setLoadingState(jb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){x.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}ca.initLogging(ca.SNOWLIFT);if(this.pivots)ca.setRelevantCount(this.pivots.relevantCount);};jb.prototype.toggleFullScreen=function(){var kb=q.toggleFullScreen(document.documentElement);if(kb){var lb=this.stream.getCurrentImageData();if(lb&&lb.url&&this.image.src!==lb.url&&this.shouldShowHiRes(lb))if(!this._log(lb.url))(new Image()).src=lb.url;ca.logEnterFullScreen(this.stream.getCursor());}};jb.prototype.getStream=function(){return this.stream;};jb.prototype.fetchInitialData=function(){this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();la.loadFromEndpoint('PhotoViewerInitPagelet',xa('pagelet_photo_viewer_init',this.root),this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true});};jb.prototype.toggleCollapse=function(){if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};jb.prototype.collapseRHC=function(){this.rhcCollapsed=true;l.addClass(this.root,'collapseRHC');this.adjustForResize();};jb.prototype.uncollapseRHC=function(){this.rhcCollapsed=false;l.removeClass(this.root,'collapseRHC');this.adjustForResize();};jb.prototype.closeHandler=function(){if(!this.isOpen)return;this.closingAction=this.closingAction||ca.ESC;if(ma.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};jb.prototype.returnToStartingURI=function(kb,lb){if(!kb)if(lb){this.squashNextTransition(ya.curry(lb));}else this.squashNextTransition();this.returningToStart=true;var mb=g.subscribe('page_transition',(function(){this.returningToStart=false;mb.unsubscribe();}).bind(this)),nb=kb||isNaN(na.opera()),ob=this._uriStack.length;if(nb&&ob<window.history.length){window.history.go(-ob);}else{var pb=this.startingURI,qb=new ma(pb).removeQueryData('closeTheater');if(pb.getQueryData().sk=='approve'&&pb.getPath()=='/profile.php'){qb.removeQueryData('highlight');qb.removeQueryData('notif_t');}ya(qb);}};jb.prototype.squashNextTransition=function(kb){this.squashNext=true;x.registerHandler(function lb(){if(this.squashNext){this.squashNext=false;if(kb)kb.defer();x.transitionComplete(true);return true;}return false;}.bind(this),7);};jb.prototype.handleNavigateAway=function(kb){var lb=ra(x._most_recent_uri.getQualifiedURI(),kb.getAttribute('href'));if(this.isOpen&&ab(lb.getPath(),'/hashtag/')){this.close();return true;}if(this.isOpen&&(lb instanceof ma)&&lb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&lb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=ca.NAVIGATE;this.returnToStartingURI(false,lb);this.close();return false;}return true;};jb.prototype.postProcessTaggedPhotos=function(){if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var kb=null;if(this.source===jb.COLLECTIONS_UNTAGGED_PHOTOS){kb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===jb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===jb.FRIENDS_IN_PHOTOS_SUGGESTIONS)kb='/ajax/photos/photo/add_to_star_grid/';if(kb)new j().setURI(kb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};jb.prototype.onTagSaved=function(kb,lb){if(this.taggedPhotoIds){if(this.source===jb.PHOTOS_OF_YOU_SUGGESTIONS&&!lb.self_tag)return;this.taggedPhotoIds.push(lb.photo_fbid);}};jb.prototype.close=function(){if(!this.isOpen)return;this.isOpen=false;if(this.fullscreen)q.disableFullScreen();cb('snowlift').uai('close');this.cropper&&this.cropper.disableCropping();this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();g.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;this.closeCleanup.bind(this).defer();};jb.prototype.closeCleanup=function(){this.closeDirty=false;l.removeClass(this.root,'dataLoading');ca.logPhotoViews(this.closingAction);this.destroy();l.hide(this.errorBox);l.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;l.removeClass(this.stageWrapper,'showVideo');n.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.rhcMinHeight=null;this.setStagePagersState('reset');this.recacheData();n.empty(this.sideAdUnit);this.stream.destroy();var kb=this.closingAction===ca.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){x.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',kb);this.root.setAttribute('aria-busy','true');};jb.prototype.createLoader=function(kb){if(this.currentImageSize===null){this.adjustStageSize(jb.STAGE_MIN);}else{var lb=this.getStageSize(this.currentImageSize);lb=new oa(Math.max(lb.x,jb.STAGE_MIN.x),Math.max(lb.y,jb.STAGE_MIN.y));var mb=this.getImageSizeInStage(this.currentImageSize,lb);if(this.thumbSrc===null){this.adjustStageSize(mb);}else this.useImage(n.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:mb.x+'px',height:mb.y+'px'}}),mb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(kb)(function(){var nb=new Image(),ob=p.listen(nb,'load',qa(function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(kb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(jb.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater')),pb=function(){if(ob){ob.remove();ob=null;}};g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',pb);g.subscribeOnce('PhotoSnowlift.CLOSE',pb);this._log(kb);nb.src=kb;}).bind(this).defer();l.hide(this.stageActions);this.setStagePagersState('disabled');};jb.prototype.initDataFetched=function(kb){ca.setPhotoSet(this.stream.getPhotoSet());ca.setLogFbids(kb.logids);var lb=this.stream.getCurrentImageData();ca.addPhotoView(lb.info,this.shouldShowHiRes(lb),this.fullscreen&&q.isFullScreen());var mb=this.stream.getCurrentExtraData();if(mb&&mb.source!==undefined){this.source=parseInt(mb.source,10);ca.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[p.listen(this.root,'click',this.pageListener.bind(this)),p.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];l.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=kb.loggedin;this.disableAdsForSession=kb.disablesessionads||!this.isLoggedInViewer;this.showFlashTags=!!kb.flashtags;this.disableAds=this.disableAdsForSession||kb.fromad;this.loadAds();};jb.prototype.adjustScrollerIfNecessary=function(){clearTimeout(this.scrollerTimeout);this.scrollerTimeout=this.adjustScroller.bind(this).defer();};jb.prototype.adjustScroller=function(kb){clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var lb=oa.getElementDimensions(this.rhc),mb=lb.y;mb-=oa.getElementDimensions(this.rhcHeader).y;mb-=oa.getElementDimensions(this.ufiInputContainer).y;if(this.productMetadata){var nb=oa.getElementDimensions(this.productMetadata);if(nb.x!==0)mb-=nb.y;}if(kb==null)kb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=kb;this.rhcMinHeight=lb.y-(mb-jb.MIN_UFI_HEIGHT);mb=Math.max(0,mb);var ob=oa.getElementDimensions(this.scrollerBody).y,pb=Math.max(jb.MIN_UFI_HEIGHT,mb-kb);if(ob>=pb){if(mb>pb){l.removeClass(this.rhc,'pinnedUfi');mb-=pb;}else{if(this.redesign&&oa.getElementDimensions(this.ufiInputContainer).y<jb.ADD_COMMENT_HEIGHT)pb-=jb.PINNED_UFI_ADJUSTMENT;l.addClass(this.rhc,'pinnedUfi');mb=0;}ja.set(this.scroller,'height',pb+'px');}else{ja.set(this.scroller,'height','auto');l.removeClass(this.rhc,'pinnedUfi');mb-=ob;}if(this.redesign){var qb=n.scry(this.ufiInputContainer,'li.UFIAddComment');if(qb.length!==0){var rb=n.scry(this.scrollerBody,'li.UFIComment.display');if(rb.length===0){l.addClass(qb[0],'UFIFirstComponent');}else l.removeClass(qb[0],'UFIFirstComponent');}}var sb=oa.getElementDimensions(this.ufiInputContainer).y;ja.set(this.ufiForm,'padding-bottom',sb+'px');da.resize(new oa(lb.x,mb));this.scrollableArea.adjustGripper();};jb.prototype.adjustForResize=function(){this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();};jb.prototype.shouldShowHiRes=function(kb){if(!kb||!kb.smallurl)return false;var lb=this.getStageSize(kb.dimensions);lb=this._adjustStageSizeForPixelRatio(lb);var mb=this.getImageSizeInStage(kb.dimensions,lb);return (mb.x>jb.STAGE_NORMAL_MAX.x||mb.y>jb.STAGE_NORMAL_MAX.y);};jb.prototype._adjustStageSizeForPixelRatio=function(kb){if(window.devicePixelRatio&&window.devicePixelRatio>1)kb=new oa(kb.x*window.devicePixelRatio,kb.y*window.devicePixelRatio);return kb;};jb.prototype.getImageURL=function(kb){if(kb.video){return null;}else if(kb.smallurl&&!this.shouldShowHiRes(kb))return kb.smallurl;return kb.url;};jb.prototype.getImageDimensions=function(kb){if(kb.smalldims&&(!this.shouldShowHiRes(kb)||this.image.src===kb.smallurl))return kb.smalldims;return kb.dimensions;};jb.prototype.getStageSize=function(kb,lb){var mb=oa.getViewportDimensions(),nb=new oa(kb.x,kb.y);if(lb)nb=new oa(Math.max(kb.x,lb.x),Math.max(kb.y,lb.y));var ob,pb;if(this.fullscreen&&q.isFullScreen()){return new oa((this.rhcCollapsed?screen.width:screen.width-jb.SIDEBAR_SIZE_MAX),screen.height-jb.FULL_SCREEN_PADDING*2);}else{ob=Math.min(nb.x,this.stageMax.x,(mb.x-jb.SIDEBAR_SIZE_MAX-jb.STAGE_CHROME.x));pb=Math.min(nb.y,this.stageMax.y,mb.y-jb.STAGE_CHROME.y);}if(ob===0&&pb===0)return new oa(0,0);var qb=ob/pb,rb=nb.x/nb.y;if(qb<rb)return new oa(ob,Math.round(ob/rb));return new oa(Math.round(pb*rb),pb);};jb.prototype.getImageSizeInStage=function(kb,lb){var mb=kb.x,nb=kb.y;if(mb>=lb.x||nb>=lb.y){var ob=lb.x/lb.y,pb=mb/nb;if(ob<pb){mb=lb.x;nb=Math.round(mb/pb);}else if(ob>pb){nb=lb.y;mb=Math.round(nb*pb);}else{mb=lb.x;nb=lb.y;}}return new oa(mb,nb);};jb.prototype.adjustStageSize=function(kb){var lb=this.currentImageSize;if(kb){lb=kb;}else{var mb=this.stream&&this.stream.getCurrentImageData();if(mb)lb=this.getImageDimensions(mb);}if(!lb)return;this.currentImageSize=lb;var nb=0;if(this.shouldStretch&&!this.getVideoOnStage()&&lb.x>lb.y&&lb.x<=jb.TIMELINE_STRETCH_WIDTH&&lb.x>=jb.TIMELINE_STRETCH_MIN){lb.y=Math.round(lb.y*jb.TIMELINE_STRETCH_WIDTH/lb.x);lb.x=jb.TIMELINE_STRETCH_WIDTH;}else if(this.getVideoOnStage())nb=jb.VIDEO_BOTTOM_BAR_SPACE*2;var ob=this.getStageSize(lb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new oa(0,0);if(!this.rhcMinHeight)this.rhcMinHeight=0;this.currentMinSize=new oa(Math.max(ob.x,jb.STAGE_MIN.x,this.currentMinSize.x),Math.max(ob.y,jb.STAGE_MIN.y,this.currentMinSize.y));var pb=this.getImageSizeInStage(lb,this.currentMinSize),qb=this.currentMinSize.x-pb.x,rb=this.currentMinSize.y-pb.y;if(qb>0&&qb<jb.PADDING_MIN){this.currentMinSize.x-=qb;}else if(rb>0&&rb<jb.PADDING_MIN)this.currentMinSize.y-=rb;var sb=n.scry(this.productMetadata,'#fbPhotoSnowliftTaggedProducts .taggee');if(sb.length)this.currentMinSize.y=Math.max(this.currentMinSize.y,this.rhcMinHeight);var tb=this.currentMinSize.x+jb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)tb=this.currentMinSize.x;this.snowliftPopup.style.cssText='width:'+tb+'px;'+'height:'+this.currentMinSize.y+'px;';var ub=this.currentMinSize.y-nb+'px';if(na.firefox()||na.ie()<8){var vb=ja.get(this.stageWrapper,'font-size');if(na.ie()&&vb.indexOf('px')<0){var wb=n.create('div');wb.style.fontSize=vb;wb.style.height='1em';vb=wb.style.pixelHeight;}ub=((this.currentMinSize.y-nb)/parseFloat(vb))+'em';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+ub+';';if(na.ie()<8){ja.set(this.root,'height',oa.getViewportDimensions().y+'px');ja.set(this.container,'min-height',(this.currentMinSize.y+jb.STAGE_CHROME.y)+'px');}this.image.style.cssText='width:'+pb.x+'px;'+'height:'+pb.y+'px;';var xb=this.getTagger();if(xb)xb.repositionTagger();this.adjustScrollerIfNecessary();};jb.prototype.adjustForNewData=function(){if(!this.image)return;var kb=n.scry(this.stage,'div.tagsWrapper')[0],lb=oa.getElementDimensions(this.image);if(kb){ja.set(kb,'width',lb.x+'px');ja.set(kb,'height',lb.y+'px');if(na.ie()<=7){var mb=n.scry(this.root,'div.tagContainer')[0];if(mb)l.conditionClass(kb,'ie7VerticalFix',oa.getElementDimensions(mb).y>lb.y);}}};jb.prototype.adsDisplayedCallback=function(kb,lb){var mb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&kb<jb.MIN_ADS_VISIBLE&&lb.length>=jb.MIN_ADS_VISIBLE;if(mb){this.inAdsDisplayedCallback=true;var nb=lb[jb.MIN_ADS_VISIBLE-1];this.adjustScroller(nb);this.inAdsDisplayedCallback=false;}};jb.prototype.setLoadingState=function(kb,lb){switch(kb){case jb.STATE_IMAGE_PIXELS:l.conditionClass(this.root,'imagePixelsLoading',lb);break;case jb.STATE_IMAGE_DATA:this.loadingStates[kb]=lb;l.conditionClass(this.root,'imageLoading',lb);break;case jb.STATE_HTML:this.loadingStates[kb]=lb;l.conditionClass(this.root,'dataLoading',lb);this.rhc.setAttribute('aria-busy',lb?'true':'false');break;}};jb.prototype.destroy=function(){this.stageHandlers.forEach(function(kb){kb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(kb){kb.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;};jb.prototype.checkState=function(kb){if(kb!=jb.STATE_ERROR&&!this.loadingStates[kb])return;switch(kb){case jb.STATE_IMAGE_DATA:var lb=this.stream.getCurrentImageData();if(lb){var mb=this.getImageURL(lb);if(mb){this.switchImage(mb,null,true);}else if(lb.video)this.switchVideo(lb.video,true);this.setLoadingState(kb,false);}break;case jb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.showPagers(jb.PAGER_FADE);this.setLoadingState(kb,false);}break;default:if(this.stream.errorInCurrent()){l.hide(this.image);l.show(this.errorBox);}break;}};jb.prototype.buttonListener=function(event){var kb=event.getTarget(),lb=Date.now();if(y.byClass(kb,'fbPhotoTagApprovalBox'))return;if(y.byClass(kb,'fbPhotosCornerWantButton')){event.stop();return;}if(lb-this.lastPage<350)return;if(y.byClass(kb,'fbPhotosPhotoLike')){this.likePhoto();}else if(y.byClass(kb,'tagApproveIgnore')){this.updateTagBox(event,kb);}else if(y.byClass(kb,"_5ge9")){this.toggleSlideshow();return false;}};jb.prototype.toggleSlideshow=function(){if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};jb.prototype.startSlideshow=function(){this._slideshowToken=window.setInterval(this.page.bind(this,1,na.chrome()&&q.isFullScreen()),jb.SLIDESHOW_TIME);l.addClass(this.root,'slideshowStarted');l.removeClass(this.root,'slideshowAvailable');};jb.prototype.stopSlideshow=function(){this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;l.addClass(this.root,'slideshowAvailable');l.removeClass(this.root,'slideshowStarted');};jb.prototype.likePhoto=function(){ca.addButtonLike();var kb=pa('fbPhotoSnowliftFeedback'),lb=n.scry(kb,'button.like_link')[0];if(!lb)if(this.redesign){lb=n.scry(this.root,"a._6k6")[0];}else lb=n.scry(kb,'a.UFILikeLink')[0];var mb=lb.getAttribute('href');if(q.isFullScreen())if(na.chrome())lb.setAttribute('href','javascript:;');lb.click();lb.setAttribute('href',mb);};jb.prototype.toggleLikeButton=function(){var kb=n.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(kb){var lb=n.find(this.root,'.likeCount'),mb=n.find(lb,'.likeCountNum');if(lb)if(l.hasClass(kb,'viewerLikesThis')){n.setContent(mb,parseInt(mb.textContent,10)-1);}else n.setContent(mb,parseInt(mb.textContent,10)+1);l.toggleClass(kb,'viewerLikesThis');l.removeClass(kb,'viewerAlreadyLikedThis');}};jb.prototype.likePhotoWithKey=function(){if(this.isShowingLikePhotoConfirmation)return;if(this.skipLikePhotoConfirmation){this.likePhoto();}else i.send(new j('/photos/confirm_like.php'),function(kb){this.isShowingLikePhotoConfirmation=true;kb.subscribe('confirm',this.onCloseLikePhotoConfirmDialog.bind(this));kb.subscribe('cancel',this.onCloseLikePhotoConfirmDialog.bind(this));}.bind(this));return false;};jb.prototype.likePhotoSkipConfirmation=function(kb){this.skipLikePhotoConfirmation=kb;this.likePhoto();};jb.prototype.onCloseLikePhotoConfirmDialog=function(){this.isShowingLikePhotoConfirmation=false;};jb.prototype.updateTagBox=function(kb,lb){this.unhiliteAllTags();var mb=xa(kb);if(!mb)return;l.addClass(mb,'tagBox');l.addClass(mb,'tagBoxPendingResponse');l.removeClass(mb,'tagBoxPending');l.hide(n.find(mb,'span.tagForm'));if(lb){l.show(n.find(mb,'span.tagApproved'));}else l.show(n.find(mb,'span.tagIgnored'));};jb.prototype.rotate=function(kb){var lb=this.stream.getCursor();if(this.getVideoOnStage()){var mb=(kb=='left')?270:90;h.isTruthy(this.videoRotateURI,"Video rotate URI not set.");k.loadModules(['VideoRotate'],function(ob){new ob(lb,this.videoRotateURI).motionRotate(mb);}.bind(this));return;}var nb=sa({fbid:lb,opaquecursor:this.stream.getOpaqueCursor(lb),cs_ver:z.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());nb[kb]=1;this.setLoadingState(jb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);l.hide(this.image);new j('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(nb).setErrorHandler(this.rotationError.bind(this,lb)).setFinallyHandler(this.rotationComplete.bind(this,lb)).setMethod('POST').setReadOnly(false).send();};jb.prototype.rotationComplete=function(kb,lb){if(kb==this.stream.getCursor()){this.setLoadingState(jb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};jb.prototype.rotationError=function(kb,lb){if(kb==this.stream.getCursor()){this.setLoadingState(jb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));k.loadModules(['AsyncResponse'],function(mb){mb.defaultErrorHandler(lb);});}};jb.prototype.saveTagsFromPayload=function(kb){this.storeFromData(kb);if('data' in kb&&this.stream.getCursor() in kb.data)this.swapData();};jb.prototype.saveEdit=function(){if(!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;k.loadModules(['PhotoInlineEditor','Form'],function(kb,lb){var mb=kb.getInstance(this.getViewerConst());mb&&lb.bootstrap(mb.getForm().controller);}.bind(this));};jb.prototype.mouseLeaveListener=function(event){this.unhiliteAllTags();this.reHilitePendingTag();};jb.prototype.hilitePagerOnMouseMove=function(event){var kb=oa.getEventPosition(event),lb=oa.getElementPosition(this.stage);if(w.isRTL()){var mb=oa.getElementDimensions(this.stage);this.stagePagerPrev=mb.x-(kb.x-lb.x)<jb.GOPREV_AREA;}else this.stagePagerPrev=kb.x-lb.x<jb.GOPREV_AREA;l.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);l.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var nb,ob=event.getTarget();if(!y.byClass(ob,'snowliftOverlay')&&!y.byClass(ob,'bottomBarActions')&&!y.byClass(ob,'snowliftPager'))nb=jb.PAGER_FADE;this.showPagers(nb);};jb.prototype.showPagers=function(kb){clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof kb!=='undefined')this.fadePagerTimer=this.hidePagers.bind(this).defer(kb);};jb.prototype.hidePagers=function(){var kb=n.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(kb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};jb.prototype.getTagger=function(){if(!this.PhotoTagger)return null;var kb=this.PhotoTagger.getInstance(z.VIEWER_SNOWLIFT);if(!kb||!kb.tagHoverFacebox)return null;return kb;};jb.prototype.flashAllTags=function(){var kb=this.stream.getCurrentImageData().info.fbid;if(this.sessionPhotosHilited[kb])return;n.scry(this.stage,'div.tagsWrapper div.tagBox').forEach(function(lb){l.addClass(lb,'hover');});this.sessionPhotosHilited[kb]=true;this.unhiliteTimer=this.unhiliteAllTags.bind(this).defer(2000,true);};jb.prototype.unhiliteAllTags=function(){clearTimeout(this.unhiliteTimer);n.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(lb){l.removeClass(lb,'hover');});n.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(lb){l.removeClass(lb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!l.hasClass(this.root,'taggingMode')){var kb=this.getTagger();if(kb){kb.hideTagger();kb.setCurrentFacebox(null);}}};jb.prototype.switchHilitedTags=function(kb,lb){if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var mb=xa(kb);if(mb){this.hilitedTag=kb;if(!l.hasClass(this.root,'taggingMode')&&fa.isFacebox(this.hilitedTag)){var nb=this.getTagger();if(nb){l.addClass(mb,'hover');var ob=nb.getFacebox(kb);nb.setCurrentFacebox(ob);if(ob)nb.addTagFromFacebox(ob);}}else l.addClass(mb,'hover');if(l.hasClass(mb,'tagBoxPending')&&!l.hasClass(mb,'showPendingTagName')&&lb===true){n.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(pb){l.removeClass(pb,'showPendingTagName');});l.addClass(mb,'showPendingTagName');}}};jb.prototype.reHilitePendingTag=function(){var kb=xa(this.hilitedTag);if(kb&&l.hasClass(kb,'showPendingTagName'))return;var lb=n.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(lb)this.switchHilitedTags(lb.id);};jb.prototype.hiliteTagsOnMouseMove=function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var kb=event.getTarget();if(y.byClass(kb,'snowliftOverlay')||y.byClass(kb,'fbPhotoSnowliftTagApproval')||y.byClass(kb,'tagPointer')||y.byClass(kb,'arrow')||y.byClass(kb,'faceboxSuggestion')||y.byClass(kb,'typeaheadWrapper')||y.byClass(kb,'photoTagTypeahead'))return;var lb=y.byClass(kb,'tagBoxPending'),mb=false;if(this.hilitedTag){var nb=xa(this.hilitedTag);mb=nb&&l.hasClass(nb,'tagBoxPending');}var ob=((!this.hilitedTag&&lb)||(!mb&&lb));if(ob){this.switchHilitedTags(lb.id);return;}if(lb&&(lb.id==this.hilitedTag))return;var pb=250,qb=15,rb=oa.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=rb;var sb=fa.absoluteToNormalizedPosition(this.image,rb);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(rb)<qb){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(sb))return;var tb=fa.getNearestBox(this.stream.getCurrentExtraData().tagRects,sb);if(!tb){if(!mb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var ub=null;if(mb){var vb={};vb[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];ub=fa.getNearestBox(vb,sb);}if(ub!==null&&mb)return;if(this.hilitedTag!=tb)if(mb){this.switchTimer=this.switchHilitedTags.bind(this,tb).defer(pb);}else{if(this.showHover){if(!this.seenTags)this.seenTags=[];if(!this.seenTags[tb]){ca.addFaceTagImpression();this.seenTags[tb]=true;}}this.switchHilitedTags(tb);}};jb.prototype.currentTagHasPrecedence=function(kb){if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false;}var lb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],mb=new ha(lb.t+(lb.h()/2),lb.r,lb.b+(fa.isFacebox(this.hilitedTag)?10:0),lb.l,lb.domain);return mb.contains(kb);};jb.prototype.getVideoOnStage=function(){var kb=this.stream&&this.stream.getCurrentImageData();return kb&&kb.video;};jb.prototype.shouldPageOnAction=function(kb,lb){if(!this.isOpen||this.isShowingLikePhotoConfirmation)return false;var mb=n.isNode(lb)&&(y.byClass(lb,'snowliftPager')||y.byClass(lb,'stagePagers')||y.byClass(lb,'pivotPageColumn')),nb=n.isNode(lb)&&y.byClass(lb,'stage'),ob=l.hasClass(lb,'faceBox'),pb=(!l.hasClass(this.root,'taggingMode')&&ob&&!mb);if(pb&&this.shouldKeepFacebox){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();(function(){n.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this).defer();}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var qb=((nb&&l.hasClass(this.root,'taggingMode'))||y.byClass(lb,'tagBoxPending')||y.byClass(lb,'tagBoxPendingResponse')||y.byClass(lb,'fbPhotoTagApprovalBox')||y.byClass(lb,'tag')||(this.cropper&&this.cropper.croppingMode));if(qb)return false;return kb==t.LEFT||kb==t.RIGHT||kb==db||kb==eb||mb||pb||nb;};jb.prototype.keyHandler=function(kb,event){if(event.getModifiers().any||u.getTopmostLayer()!==this.spotlight)return true;switch(p.getKeyCode(event)){case t.LEFT:case t.RIGHT:case db:case eb:if(!this.pagersOnKeyboardNav)this.showPagers(jb.PAGER_FADE);this.pageListener(event);return false;case fb:return this.toggleFullScreen();case gb:return this.likePhotoWithKey();case t.SPACE:this.toggleSlideshow();this.showPagers(jb.PAGER_FADE);return false;}};jb.prototype.shouldHandlePendingTag=function(event){var kb=this.getTagger();if(!kb||!kb.tags.length)return false;var lb=fa.absoluteToNormalizedPosition(this.getImage(),oa.getEventPosition(event)),mb=kb.findNearestTag(lb);if(!mb||!l.hasClass(mb.node,'tagBoxPending'))return false;g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:mb.id,version:this.getVersionConst()});return true;};jb.prototype.pageListener=function(event){var kb=p.getKeyCode(event),lb=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(kb,lb))return;if(this.shouldHandlePendingTag(event))return;var mb=0;if(kb==t.RIGHT||kb==eb){mb=1;ca.setPagingAction('key_right');}else if(kb==t.LEFT||kb==db){mb=-1;ca.setPagingAction('key_left');}else if(y.byClass(lb,'next')){mb=1;ca.setPagingAction('click_next');}else if(y.byClass(lb,'prev')){mb=-1;ca.setPagingAction('click_prev');}else if(!this.stagePagerPrev){mb=1;ca.setPagingAction('click_stage');}else{mb=-1;ca.setPagingAction('click_stage_back');}var nb=n.scry(this.ufiForm,'input.mentionsHidden'),ob=false;for(var pb=0;pb<nb.length;pb++)if(!s.isEmpty(nb[pb])){ob=true;break;}if(ob||l.hasClass(this.root,'fbPhotoSnowliftEditMode')||(this.cropper&&this.cropper.croppingMode)){this.warnLeavePage(mb);}else{this.page(mb,na.chrome()&&q.isFullScreen());cb('snowlift',lb,event).uai(ca.pagingAction);}};jb.prototype.warnLeavePage=function(kb){new m().setTitle("Czy na pewno chcesz opu\u015bci\u0107 t\u0119 stron\u0119?").setBody("Istniej\u0105 niezapisane zmiany, kt\u00f3re zostan\u0105 utracone, je\u015bli opu\u015bcisz t\u0119 stron\u0119.").setButtons([{name:'leave_page',label:"Opu\u015b\u0107 t\u0119 stron\u0119",handler:this.page.bind(this,kb)},{name:'continue_editing',label:"Zosta\u0144 na tej stronie",className:'inputaux'}]).setModal(true).show();};jb.prototype.getUsesOpaqueCursor=function(){return this.stream.getUsesOpaqueCursor();};jb.prototype.getOpaqueCursor=function(kb){return this.stream.getOpaqueCursor(kb);};jb.prototype.setReachedLeftEnd=function(){this.stream.setReachedLeftEnd();};jb.prototype.setReachedRightEnd=function(){this.stream.setReachedRightEnd();};jb.prototype.page=function(kb,lb){if(!this.stream.isValidMovement(kb)||!this.stream.nonCircularPhotoSetCanPage(kb)){this.showPagers(jb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.seenTags=[];this.startingMousePos=null;this.haveLeftBufferRegion=false;var mb=this.getVideoOnStage();if(mb)this.switchVideo(mb,false);if(this.pivots&&this.pivots.page(kb))return;g.inform('PhotoSnowlift.PAGE');ka.hide();this.recacheData();this.stream.moveCursor(kb);l.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(jb.STATE_HTML,true);l.show(this.errorBox);return;}var nb=this.stream.getCurrentImageData();if(nb){var ob=this.getImageURL(nb);if(ob){this.switchImage(ob,null,true);}else if(nb.video)this.switchVideo(nb.video,true);if(!lb){this.replaceUrl=true;ya(nb.info.permalink);}this.setLoadingState(jb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(jb.STATE_IMAGE_PIXELS,true);this.setLoadingState(jb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(jb.STATE_HTML,true);this.disableAds=this.disableAdsForSession;this.loadAds();if(this.cropper)this.cropper.resetPhoto();this.setLeftAndRightPagersState();if(this._slideshowToken){l.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)l.addClass(this.root,'slideshowAvailable');};jb.prototype.logImpressionDetailsForPhoto=function(){var kb=[].concat(n.scry(pa('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),n.scry(pa('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(kb.length===0)return;var lb={};for(var mb=0;mb<kb.length;mb++)lb[kb[mb].name]=kb[mb].value;if(this.getVideoOnStage()){lb.width=0;lb.height=0;}else{var nb=this.getImageDimensions(this.stream.getCurrentImageData());lb.width=nb.x;lb.height=nb.y;}ca.addDetailData(this.stream.getCursor(),lb);da.setIsLogAdData(true);};jb.prototype.loadAds=function(){if(this.disableAds)return;da.loadAdsFromUserActivity();};jb.prototype.transitionHandler=function(kb){if(kb.getQueryData().closeTheater||kb.getQueryData().permPage||kb.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(ab(kb.getPath(),'/hashtag/')){this.close();x.transitionComplete(true);return true;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(kb.getQualifiedURI().toString());x.transitionComplete(true);return true;}var lb=this._uriStack.length;if(lb>=2&&this._uriStack[lb-2]==kb.getQualifiedURI().toString())this._uriStack.pop();var mb=this.stream.getCursorForURI(kb.getUnqualifiedURI().toString());if(mb){var nb=this.stream.getRelativeMovement(mb);this.page(nb,true);x.transitionComplete(false);return true;}if(this.isOpen){x.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};jb.prototype.recacheData=function(){if(!this.loadingStates.html){var kb=this.stream.getCurrentHtml();for(var lb in kb){kb[lb]=ta(pa(lb).childNodes);n.empty(pa(lb));}}};jb.prototype.reloadIfTimeout=function(){if(!r.hasLoaded(this.image)){var kb=this.makeNewImage(this.image.src,true);p.listen(kb,'load',this.useImage.bind(this,kb,null,true));this._log(kb.src);}};jb.prototype.useImage=function(kb,lb,mb){if(mb&&r.hasLoaded(this.image))return;n.replace(this.image,kb);this.image=kb;g.inform('Amoeba/instrument',[this.image,'image'],g.BEHAVIOR_PERSISTENT);this.adjustStageSize(lb);};jb.prototype.makeNewImage=function(kb,lb){if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!lb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),jb.LOADING_TIMEOUT);var mb=n.create('img',{className:'spotlight',alt:''});mb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');mb.setAttribute('aria-busy','true');p.listen(mb,'load',qa(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this).defer();}.bind(this),'photo_theater'));this._log(kb);mb.src=kb;return mb;};jb.prototype.switchImage=function(kb,lb,mb){l.hide(this.image);l.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var nb=this.stream&&this.stream.getCurrentImageData();if(nb)ca.addPhotoView(nb.info,this.shouldShowHiRes(nb),this.fullscreen&&q.isFullScreen());this.useImage(this.makeNewImage(kb,false),lb,false);if(mb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(this.cropper&&this.cropper.croppingMode)this.cropper.resetPhoto();g.inform('PhotoSnowlift.SWITCH_IMAGE');};jb.prototype.switchVideo=function(kb,lb){var mb='swf_'+kb;if(lb){l.addClass(this.stageWrapper,'showVideo');var nb=n.create('div',{className:'videoStageContainer'});n.appendContent(this.videoStage,nb);nb.id=kb;if(window[mb]&&!xa(mb))window[mb].write(kb);var ob='video_warning_'+kb,pb=xa(kb);if(!this.videoWarnings)this.videoWarnings=[];if(pb&&this.videoWarnings[ob])n.setContent(pb,this.videoWarnings[ob]);this.adjustStageSizeForVideo.bind(this,mb).defer();}else{window[mb]&&window[mb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);n.empty(this.videoStage);l.removeClass(this.stageWrapper,'showVideo');}};jb.prototype.checkVideoStatus=function(kb){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var lb=this.getVideoOnStage();if(!lb){return;}else{var mb='swf_'+lb;if(kb!==mb)return;this.adjustStageSizeForVideo(kb);}};jb.prototype.adjustStageSizeForVideo=function(kb){var lb=xa(kb);if(!lb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,kb),200);}else this.adjustStageSize(new oa(lb.width,lb.height));};jb.prototype.handleServerError=function(kb,lb){n.setContent(this.errorBox,kb);this.storeFromData(lb);};jb.prototype.swapData=function(){var kb,lb=this.stream.getCurrentHtml();if(lb){this.setLoadingState(jb.STATE_HTML,false);for(var mb in lb){kb=xa(mb);kb&&n.setContent(kb,lb[mb]);}g.inform('PhotoSnowlift.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.adjustScroller();this.adjustStageSize();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();if(this.showFlashTags)this.flashAllTags();};jb.prototype.updateTotalCount=function(kb,lb,mb){var nb=this.stream.getCurrentHtml();if(nb){var ob=pa('fbPhotoSnowliftPositionAndCount');n.replace(ob,mb);ob=mb;l.show(ob);var pb='fbPhotoSnowliftPositionAndCount';nb[pb]=ta(ob.childNodes);}this.stream.setTotalCount(kb);this.stream.setFirstCursorIndex(lb);};jb.prototype.addPhotoFbids=function(kb,lb,mb,nb){if(nb&&this.sessionID&&nb!=this.sessionID)return;var ob=this.stream.getCursor()===null;this.stream.attachToFbidsList(kb,lb,mb);if(mb&&ob)this.page(0,true);if(this.pivots&&mb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;l.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};jb.prototype.attachTagger=function(kb){n.appendContent(this.stageActions,kb);};jb.prototype.storeFromData=function(kb){if(!this.isOpen)return;if(kb.ssid&&this.sessionID&&this.sessionID!=kb.ssid)return;var lb=this.stream.storeToCache(kb);if('error' in lb){this.checkState(jb.STATE_ERROR);return;}if('init' in lb){this.initDataFetched(lb.init);if(this.openExplicitly){this.replaceUrl=true;ya(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in lb)this.checkState(jb.STATE_IMAGE_DATA);if('data' in lb)this.checkState(jb.STATE_HTML);};jb.prototype.setLeftAndRightPagersState=function(){if(this.stream.isNonCircularPhotoSet()){l.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));l.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}};jb.prototype.setStagePagersState=function(kb){switch(kb){case 'ready':l.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':l.addClass(this.root,'pagingActivated');return;case 'inactive':l.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':l.removeClass(this.root,'pagingReady');return;}};jb.prototype.deletePhoto=function(kb){this.closeRefresh();};jb.prototype.closeRefresh=function(){this.refreshOnClose=true;this.closeHandler();};jb.prototype.onHiliteTag=function(kb,lb){if(lb.version!=z.VIEWER_SNOWLIFT)return;var mb=lb.tag;if(mb)this.switchHilitedTags(mb,true);};jb.prototype.onUpdateTagBox=function(kb,lb){if(lb.version==z.VIEWER_SNOWLIFT)this.updateTagBox(lb.id,lb.approve);};jb.prototype._log=function(kb){if(this._shouldLog){this._logger&&this._logger.log(kb);return true;}return false;};jb.getInstance=function(){if(!jb._instance)jb._instance=new jb();return jb._instance;};jb.initWithSpotlight=function(kb,lb){jb.getInstance().init(kb,lb);};jb.addPhotoFbids=function(kb,lb,mb,nb){jb.getInstance().addPhotoFbids(kb,lb,mb,nb);};jb.setReachedLeftEnd=function(){jb.getInstance().setReachedLeftEnd();};jb.setReachedRightEnd=function(){jb.getInstance().setReachedRightEnd();};jb.attachFollowFlyout=function(kb){n.insertAfter(pa('fbPhotoSnowliftSubscribe'),kb);};jb.attachSubscribeFlyout=function(kb){n.insertAfter(pa('fbPhotoSnowliftSubscribe'),kb);};jb.attachTagger=function(kb){jb.getInstance().attachTagger(kb);};jb.preload=function(kb,lb){jb.getInstance().preload(kb,lb);};jb.bootstrap=function(kb,lb){if(kb&&ma(kb).getQueryData().hasOwnProperty('share_id')){k.loadModules(['SpotlightShareViewer'],function(mb){mb.bootstrap(kb,lb);});return;}jb.getInstance().bootstrap(kb,lb);};jb.closeRefresh=function(){jb.getInstance().closeRefresh();};jb.deletePhoto=function(kb){jb.getInstance().deletePhoto(kb);};jb.getImage=function(){return jb.getInstance().getImage();};jb.getImageId=function(){return jb.getInstance().getImageId();};jb.getLoadQuery=function(){return jb.getInstance().getLoadQuery();};jb.getRHCBody=function(){return jb.getInstance().getRHCBody();};jb.getRHCFooter=function(){return jb.getInstance().getRHCFooter();};jb.getRHCHeader=function(){return jb.getInstance().getRHCHeader();};jb.getRoot=function(){return jb.getInstance().getRoot();};jb.likePhotoSkipConfirmation=function(kb){jb.getInstance().likePhotoSkipConfirmation(kb);};jb.saveTagsFromPayload=function(kb){jb.getInstance().saveTagsFromPayload(kb);};jb.saveTagsFromPayloadDelayed=function(kb){jb.saveTagsFromPayload.curry(kb).defer(2000);};jb.handleServerError=function(kb,lb){jb.getInstance().handleServerError(kb,lb);};jb.setVideoWarning=function(kb,lb){var mb=jb.getInstance(),nb='video_warning_'+kb;if(!mb.videoWarnings)mb.videoWarnings=[];mb.videoWarnings[nb]=lb;};jb.storeFromData=function(kb){jb.getInstance().storeFromData(kb);};jb.swapData=function(){jb.getInstance().swapData();};jb.updateTotalCount=function(kb,lb,mb){jb.getInstance().updateTotalCount(kb,lb,mb);};jb.setVideoRotateURI=function(kb){jb.getInstance().videoRotateURI=kb;};sa(jb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_HIRES_MAX:{x:2048,y:2048},STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:wa,touchMarkup:wa});sa(jb.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:jb.STAGE_NORMAL_MAX,stageChrome:jb.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null,showHover:false,skipLikePhotoConfirmation:false,isShowingLikePhotoConfirmation:false});e.exports=jb;});