/*!CK:2280604990!*//*1380450318,173224515*/

if (self.CavalryLogger) { CavalryLogger.start_js(["a5DmL"]); }

__d("ComposerXAttachmentBootstrap",["CSS","Form","Parent","URI","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('Form'),i=b('Parent'),j=b('URI'),k=b('cx'),l=[],m={bootstrap:function(n){m.load(i.byTag(n,'form'),n.getAttribute('data-endpoint'));},load:function(n,o,p){var q=j(o).addQueryData({composerurihash:m.getURIHash(o)});g.conditionClass(n,"_fu",p);var r=i.byClass(n,"_2_4");g.removeClass(r,'async_saving');h.setDisabled(n,false);n.action=q.toString();h.bootstrap(n);},getURIHash:function(n){if(n==='initial')return 'initial';var o=l.indexOf(n);if(o!==-1){return o+'';}else{o=l.length;l[o]=n;return o+'';}}};e.exports=m;});
__d("ComposerXStore",["function-extensions","Arbiter","ge"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ge'),i={};function j(l,m){return 'ComposerX/'+l+'/'+m;}var k={set:function(l,m,n){if(!i[l])i[l]={};i[l][m]=n;g.inform(j(l,m),{},g.BEHAVIOR_STATE);},get:function(l,m){if(i[l])return i[l][m];return null;},getAllForComposer:function(l){return i[l]||{};},waitForComponents:function(l,m,n){g.registerCallback(n,m.map(j.curry(l)));}};g.subscribe('page_transition',function(){for(var l in i)if(!h(l))delete i[l];});e.exports=k;});
__d("ComposerX",["Arbiter","ComposerXAttachmentBootstrap","ComposerXStore","CSS","DOM","DOMQuery","copyProperties","csx","cx","getObjectValues"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerXAttachmentBootstrap'),i=b('ComposerXStore'),j=b('CSS'),k=b('DOM'),l=b('DOMQuery'),m=b('copyProperties'),n=b('csx'),o=b('cx'),p=b('getObjectValues'),q='any';function r(s){this._root=s;this._composerID=s.id;this._attachments={};this._attachmentFetchForm=l.find(s,"._2_4");this._resetSubscription=g.subscribe('composer/publish',function(t,u){if(u.composer_id===this._composerID)this.reset();}.bind(this));}r.prototype.getAttachment=function(s,t,u){var v=h.getURIHash(s);this._endpointHashToShow=v;var w=this._attachments[v];if(w){this._showAttachmentAfterComponentsLoaded(v,u);}else this.fetchAttachmentData(s,t);};r.prototype.fetchAttachmentData=function(s,t){var u=h.getURIHash(s);if(this._attachments[u])return;if(s!==this._lastFetchEndpoint){h.load(this._attachmentFetchForm,s,t);this._lastFetchEndpoint=s;}};r.prototype.setAttachment=function(s,t,u,v){this._setupAttachment(s,t,u,v);this._showAttachmentAfterComponentsLoaded(s,false);};r.prototype.setInitialAttachment=function(s,t,u,v){var w=h.getURIHash(s);this._setupAttachment(w,t,u,v);this._initialAttachmentEndpoint=s;if(!this._currentInstance)this._showAttachmentAfterComponentsLoaded(w,true);};r.prototype.setComponent=function(s,t){if(!i.get(this._composerID,s)){i.set(this._composerID,s,t);k.appendContent(this._attachmentFetchForm,k.create('input',{type:'hidden',name:'loaded_components[]',value:s}));}};r.prototype.reset=function(){if(this._currentInstance){this._currentInstance.cleanup();this._currentInstance=null;}for(var s in this._attachments)this._attachments[s].instance.reset();var t=i.getAllForComposer(this._composerID);p(t).forEach(function(u){if(u.reset)u.reset(u);});this.getAttachment(this._initialAttachmentEndpoint,false,true);g.inform('composer/reset');};r.prototype.destroy=function(){if(this._resetSubscription){this._resetSubscription.unsubscribe();this._resetSubscription=null;}};r.prototype.addPlaceholders=function(s,t){var u;for(var v in this._attachments){u=this._attachments[v];if(u.instance===s){t.forEach(function(w){u.placeholders.push(w);u.required_components.push(w.component_name);});break;}}if(this._currentInstance===s)this._fillPlaceholders(t);};r.prototype.hasAttachmentWithClassName=function(s){return l.scry(this._root,'.'+s).length>0;};r.prototype._setupAttachment=function(s,t,u,v){t.setComposerID(this._composerID);this._attachments[s]={instance:t,placeholders:u,required_components:v};var w=l.find(this._root,"div._55d0"),x=t.getRoot();if(x.parentNode!==w){j.hide(x);k.appendContent(w,x);}};r.prototype._showAttachment=function(s,t,u,v){if(this._currentInstance===s)return;if(this._endpointHashToShow===q){this._endpointHashToShow=null;}else if(this._endpointHashToShow!==t)return;if(this._currentInstance){if(!this._currentInstance.canSwitchAway())return;this._currentInstance.cleanup();}this._currentInstance=s;var w=l.find(this._root,"div._55d0"),x=w.childNodes,y=s.getRoot();for(var z=0;z<x.length;z++)if(x[z]!==y)j.hide(x[z]);j.show(y);this._fillPlaceholders(u);s.initWithComponents(v);this._setAttachmentSelectedClass(s.attachmentClassName);g.inform('composer/initializedAttachment',{composerRoot:this._root,isInitial:v});};r.prototype._showAttachmentAfterComponentsLoaded=function(s,t){var u=this._attachments[s];i.waitForComponents(this._composerID,u.required_components,this._showAttachment.bind(this,u.instance,s,u.placeholders,t));};r.prototype._fillPlaceholders=function(s){s.forEach(function(t){var u=i.get(this._composerID,t.component_name);if(t.element!==u.element.parentNode)k.setContent(t.element,u.element);}.bind(this));};r.prototype._setAttachmentSelectedClass=function(s){var t=l.scry(this._root,"._519b")[0],u;if(t){j.removeClass(t,"_519b");u=l.scry(t,'*[aria-pressed="true"]')[0];if(u)u.setAttribute('aria-pressed','false');}if(s){var v=l.scry(this._root,'.'+s)[0];if(v){j.addClass(v,"_519b");u=l.scry(v,'*[aria-pressed="false"]')[0];if(u)u.setAttribute('aria-pressed','true');}}};m(r.prototype,{_endpointHashToShow:q,_lastFetchEndpoint:'',_initialAttachmentEndpoint:''});e.exports=r;});
__d("ComposerXAttachment",["ComposerXStore","copyProperties"],function(a,b,c,d,e,f){var g=b('ComposerXStore'),h=b('copyProperties');function i(){}i.prototype.getRoot=function(){};i.prototype.initWithComponents=function(j){};i.prototype.cleanup=function(){};i.prototype.reset=function(){};i.prototype.getComponent=function(j){return g.get(this._composerID,j);};i.prototype.canSwitchAway=function(){return true;};i.prototype.setComposerID=function(j){this._composerID=j;};i.prototype.allowOGTagPreview=function(){return false;};h(i.prototype,{attachmentClassName:''});e.exports=i;});
__d("ComposerXController",["Arbiter","ComposerX","ComposerXAttachmentBootstrap","Parent","$","cx","emptyFunction","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerX'),i=b('ComposerXAttachmentBootstrap'),j=b('Parent'),k=b('$'),l=b('cx'),m=b('emptyFunction'),n=b('ge'),o={};function p(r){var s=j.byClass(k(r),"_119"),t=s.id;if(!o[t])o[t]=new h(s);return o[t];}var q={getAttachment:function(r,s,t){var u=p(r);u.getAttachment(s,t);},fetchAttachmentData:function(r,s,t){p(r).fetchAttachmentData(s,t);},setAttachment:function(r,s,t,u,v){var w=p(r);w.setAttachment(s,t,u,v);},setInitialAttachment:function(r,s,t,u,v){var w=p(r);w.setInitialAttachment(s,t,u,v);},setComponent:function(r,s,t){var u=p(r);u.setComponent(s,t);},reset:function(r){var s=p(r);s.reset();},holdTheMarkup:m,getEndpoint:function(r,s,t){var u=p(r);i.load(u._attachmentFetchForm,s,t);},addPlaceholders:function(r,s,t){var u=p(r);u.addPlaceholders(s,t);},hasAttachmentWithClassName:function(r,s){var t=p(r);return t.hasAttachmentWithClassName(s);}};i.bootstrap=function(r){q.getAttachment(r,r.getAttribute('data-endpoint'));};g.subscribe('page_transition',function(){for(var r in o)if(!n(r)){o[r].destroy();delete o[r];}});e.exports=q;});
__d("DragDropFileUpload",[],function(a,b,c,d,e,f){f.isSupported=function(){return typeof(FileList)!=="undefined";};});
__d("DocumentDragDrop",["Event","Arbiter","CSS","DOM","DOMQuery","DragDropFileUpload","emptyFunction","getObjectValues"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('DOMQuery'),l=b('DragDropFileUpload'),m=b('emptyFunction'),n=b('getObjectValues'),o={},p=0;function q(){p=0;n(o).forEach(function(t){i.removeClass(t.element,t.className);h.inform('dragleave',{element:t.element});});}function r(){if(!l.isSupported())return;g.listen(document,'dragenter',function(u){if(p===0)n(o).forEach(function(v){i.addClass(v.element,v.className);h.inform('dragenter',{element:v.element,event:u});});p++;});g.listen(document,'dragleave',function(u){p--;if(p===0)q();});g.listen(document,'drop',function(u){var v=u.getTarget();if(k.isNodeOfType(u.getTarget(),'input'))if(v.type==='file')return;u.prevent();});g.listen(document,'dragover',g.prevent);var t=null;document.addEventListener('dragover',function(){t&&clearTimeout(t);t=setTimeout(q,839);},true);r=m;}var s={registerStatusElement:function(t,u){r();o[j.getID(t)]={element:t,className:u};},removeStatusElement:function(t){var u=j.getID(t),v=o[u];if(v){i.removeClass(v.element,v.className);delete o[u];}}};e.exports=s;});
__d("DragDropTarget",["Event","CSS","DocumentDragDrop","DragDropFileUpload","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DocumentDragDrop'),j=b('DragDropFileUpload'),k=b('copyProperties'),l=b('emptyFunction');function m(n){this._element=n;this._listeners=[];this._statusElem=n;this._dragEnterCount=0;this._enabled=false;}k(m.prototype,{_onFilesDropCallback:l,_onURLDropCallback:l,_onPlainTextDropCallback:l,_onDropCallback:l,_fileFilterFn:l.thatReturnsArgument,setOnFilesDropCallback:function(n){this._onFilesDropCallback=n;return this;},setOnURLDropCallback:function(n){this._onURLDropCallback=n;return this;},setOnPlainTextDropCallback:function(n){this._onPlainTextDropCallback=n;return this;},setOnDropCallback:function(n){this._onDropCallback=n;return this;},enable:function(){if(!j.isSupported())return this;i.registerStatusElement(this._statusElem,'fbWantsDragDrop');this._listeners.push(g.listen(this._element,'dragenter',this._onDragEnter.bind(this)));this._listeners.push(g.listen(this._element,'dragleave',this._onDragLeave.bind(this)));this._listeners.push(g.listen(this._element,'dragover',g.kill));this._listeners.push(g.listen(this._element,'drop',function(n){this._dragEnterCount=0;h.removeClass(this._statusElem,'fbDropReady');h.removeClass(this._statusElem,'fbDropReadyPhoto');h.removeClass(this._statusElem,'fbDropReadyPhotos');h.removeClass(this._statusElem,'fbDropReadyLink');var o={},p=false,q=this._fileFilterFn(n.dataTransfer.files);if(q.length){this._onFilesDropCallback(q,n);o.files=q;p=true;}var r=n.dataTransfer.getData('url')||n.dataTransfer.getData('text/uri-list');if(r){this._onURLDropCallback(r,n);o.url=r;p=true;}var s=n.dataTransfer.getData('text/plain');if(s){this._onPlainTextDropCallback(s,n);o.plainText=s;p=true;}if(p)this._onDropCallback(o,n);n.kill();}.bind(this)));this._enabled=true;return this;},disable:function(){if(!this._enabled)return this;i.removeStatusElement(this._statusElem,'fbWantsDragDrop');h.removeClass(this._statusElem,'fbDropReady');h.removeClass(this._statusElem,'fbDropReadyPhoto');h.removeClass(this._statusElem,'fbDropReadyPhotos');h.removeClass(this._statusElem,'fbDropReadyLink');while(this._listeners.length)this._listeners.pop().remove();this._enabled=false;return this;},setFileFilter:function(n){this._fileFilterFn=n;return this;},setStatusElement:function(n){this._statusElem=n;return this;},_onDragEnter:function(n){if(this._dragEnterCount===0){var o=n.dataTransfer.items,p=false;for(var q=0;q<o.length;q++)if(!o[q].type.match('image/*')){p=true;break;}h.addClass(this._statusElem,'fbDropReady');if(p){h.addClass(this._statusElem,'fbDropReadyLink');}else if(o.length>1){h.addClass(this._statusElem,'fbDropReadyPhotos');}else h.addClass(this._statusElem,'fbDropReadyPhoto');}this._dragEnterCount++;},_onDragLeave:function(){this._dragEnterCount=Math.max(this._dragEnterCount-1,0);if(this._dragEnterCount===0){h.removeClass(this._statusElem,'fbDropReady');h.removeClass(this._statusElem,'fbDropReadyPhoto');h.removeClass(this._statusElem,'fbDropReadyPhotos');h.removeClass(this._statusElem,'fbDropReadyLink');}}});e.exports=m;});
__d("ComposerXDragDrop",["Arbiter","ComposerXController","CSS","DOMQuery","DragDropTarget","Parent","URI","csx","cx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerXController'),i=b('CSS'),j=b('DOMQuery'),k=b('DragDropTarget'),l=b('Parent'),m=b('URI'),n=b('csx'),o=b('cx'),p='/ajax/composerx/attachment/media/upload/',q='/ajax/composerx/attachment/link/scraper/',r=function(t){t();};function s(t,u,v,w){this._root=t;this._composerID=u;this._targetID=v;w=w||r;this._dragdrop=new k(t).setOnFilesDropCallback(function(x){w(this._uploadFiles.bind(this,x));}.bind(this)).setFileFilter(s.filterImages).enable();s.handleDragEnterAndLeave(t);g.subscribe('composer/deactivateDragdrop',function(){this.deactivate();}.bind(this));g.subscribe('composer/reactivateDragdrop',function(){this.reactivate();}.bind(this));}s.prototype.enableURLDropping=function(){this._dragdrop.setOnURLDropCallback(this._onURLDrop.bind(this));};s.prototype.deactivate=function(){this._dragdrop.disable();};s.prototype.reactivate=function(){this._dragdrop.enable();};s.prototype._uploadFiles=function(t){h.getAttachment(this._root,p);g.inform('ComposerXFilesStore/filesDropped/'+this._composerID+'/mediaupload',{files:t},g.BEHAVIOR_PERSISTENT);};s.prototype._onURLDrop=function(t){var u=new m(q);u.addQueryData({scrape_url:encodeURIComponent(t)});h.getAttachment(this._root,u.toString());};s.handleDragEnterAndLeave=function(t){var u=j.scry(l.byClass(t,"_119"),"._2wr");g.subscribe('dragenter',function(v,w){if(t==w.element)u.forEach(i.hide);});g.subscribe('dragleave',function(v,w){if(t==w.element)u.forEach(i.show);});};s.filterImages=function(t){var u=[];for(var v=0;v<t.length;v++)if(t[v].type.match('image/*'))u.push(t[v]);return u;};e.exports=s;});